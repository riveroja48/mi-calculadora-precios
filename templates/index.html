<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <title>Gestor de Precios e Inventario</title>
    <style>
        body { background-color: #f8f9fa; }
        .card { border-radius: 15px; border: none; }
        .table { vertical-align: middle; }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row mb-4">
            <div class="col">
                <h2 class="fw-bold text-primary">Calculadora de Precios e Inventario</h2>
                <p class="text-muted">Gestiona tus costos, márgenes y stock en un solo lugar.</p>
            </div>
        </div>
        
        <div class="card card-body mb-4 shadow-sm">
            <h5 class="card-title mb-3">Registrar Nuevo Producto</h5>
            <form action="/agregar" method="POST" class="row g-3">
                <div class="col-md-4">
                    <label class="form-label small">Nombre del Producto</label>
                    <input type="text" name="nombre" class="form-control" placeholder="Ej: Camiseta Algodón" required>
                </div>
                <div class="col-md-2">
                    <label class="form-label small">Stock Inicial</label>
                    <input type="number" name="stock" class="form-control" placeholder="0">
                </div>
                <div class="col-md-2">
                    <label class="form-label small">Costo Insumos ($)</label>
                    <input type="number" step="0.01" name="insumos" class="form-control" placeholder="0.00">
                </div>
                <div class="col-md-2">
                    <label class="form-label small">Mano de Obra ($)</label>
                    <input type="number" step="0.01" name="mano_obra" class="form-control" placeholder="0.00">
                </div>
                <div class="col-md-2">
                    <label class="form-label small">Costos Fijos ($)</label>
                    <input type="number" step="0.01" name="fijos" class="form-control" placeholder="0.00">
                </div>
                <div class="col-md-2">
                    <label class="form-label small">Costo Envío ($)</label>
                    <input type="number" step="0.01" name="envio" class="form-control" placeholder="0.00">
                </div>
                <div class="col-md-2">
                    <label class="form-label small">% Margen Deseado</label>
                    <input type="number" step="0.01" name="margen" class="form-control" placeholder="Ej: 20">
                </div>
                <div class="col-md-2">
                    <label class="form-label small">% IVA</label>
                    <input type="number" step="0.01" name="iva" class="form-control" placeholder="Ej: 19">
                </div>
                <div class="col-md-3">
                    <label class="form-label small">% Comisión Plataforma</label>
                    <input type="number" step="0.01" name="comision" class="form-control" placeholder="Ej: 5">
                </div>
                <div class="col-md-3">
                    <label class="form-label small">% Devoluciones</label>
                    <input type="number" step="0.01" name="devolucion" class="form-control" placeholder="Ej: 2">
                </div>
                <div class="col-12 mt-4">
                    <button class="btn btn-primary px-5 shadow-sm">Guardar y Calcular Precio</button>
                </div>
            </form>
        </div>

        <div class="card shadow-sm overflow-hidden">
            <table class="table table-hover mb-0">
                <thead class="table-dark">
                    <tr>
                        <th>Producto</th>
                        <th>Stock</th>
                        <th>Costo Base</th>
                        <th>Margen</th>
                        <th>Precio de Venta Sugerido</th>
                        <th class="text-center">Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for p in productos %}
                    <tr>
                        <td class="fw-bold">{{ p.nombre }}</td>
                        <td>
                            <span class="badge {% if p.stock > 10 %}bg-success{% else %}bg-danger{% endif %}">
                                {{ p.stock }} und
                            </span>
                        </td>
                        <td>${{ "{:,.2f}".format(p.insumos + p.mano_obra + p.fijos_por_unidad + p.envio) }}</td>
                        <td>{{ (p.margen_deseado * 100)|round(1) }}%</td>
                        <td class="text-success fw-bold fs-5">${{ "{:,.2f}".format(p.calcular_precio_sugerido()) }}</td>
                        <td class="text-center">
                            <div class="btn-group shadow-sm">
                                <a href="/editar/{{ p.id }}" class="btn btn-sm btn-outline-warning">
                                    Editar
                                </a>
                                <a href="/eliminar/{{ p.id }}" 
                                   class="btn btn-sm btn-outline-danger" 
                                   onclick="return confirm('¿Estás seguro de que quieres eliminar este producto?')">
                                    Borrar
                                </a>
                            </div>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="6" class="text-center py-4 text-muted">No hay productos registrados aún.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</body>
</html>
